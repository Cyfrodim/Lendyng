<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Цифродім – Підбір системи</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header, footer {
      background-color: #003366;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .logo a {
      text-decoration: none;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    main > div {
      background: white;
      border-radius: 10px;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin: 0.5rem 0;
    }

    input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      margin-top: 1rem;
      padding: 0.7rem 1.5rem;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #004a99;
    }

    .button {
      display: inline-block;
      padding: 0.7rem 1.5rem;
      background-color: #0066cc;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }

    main img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-bottom: 1rem;
      border-radius: 5px;
    }

    #error-message {
      color: red;
      margin-bottom: 1rem;
    }

    .category-button {
      display: block;
      margin: 0.5rem auto;
      padding: 1rem;
      background-color: #0066cc;
      color: white;
      text-align: center;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-size: 1.1rem;
    }

    @media (max-width: 600px) {
      main > div {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <a href="https://cyfrodim.com/">Цифродім</a>
  </div>
</header>

<main id="main-content"></main>

<footer>
  <p>Контакти: +380 68 682 83 38</p>
</footer>

<script>
const allQuestions = {
  "video": [
    { type: "radio", question: "Яка кількість камер вас цікавить?", name: "cameras", options: ["1-2", "2-4", "більше 4 камер"], image: "./img/1.jpg" },
    { type: "radio", question: "Оберіть тип приміщення/території", name: "property_type", options: ["Приватний будинок", "Офісне приміщення", "Підприємство", "Квартира", "ОСББ"], image: "./img/2.jpg" },
    { type: "radio", question: "Роздільна здатність камер", name: "resolution", options: ["2 мегапікселі", "4 мегапікселі", "8 мегапікселів", "Залишити без відповіді"], image: "./img/3.jpg" },
    { type: "radio", question: "Місцезнаходження об'єкта монтажу", name: "location", options: ["Тернопіль", "Околиці міста Тернопіль (до 10 км)", "Більше 10 км від міста Тернопіль"], image: "./img/4.jpg" },
    { type: "contact", question: "Вкажіть будь ласка ваше ім'я та номер телефону", name: "contact", image: "" }
  ],
  "automation": [
    { type: "radio", question: "Який у Вас тип воріт?", name: "gate_type", options: ["Розпошна", "Відкатна", "Ролетна"], image: "./img/5.png" },
    { type: "radio", question: "Вага воріт?", name: "gate_weight", options: ["До 400 кілограм", "Від 400 до 600 кілограм", "Від 600 кілограм", "Залишити без відповіді"], image: "./img/7.png" },
    { type: "radio", question: "Ширина воріт?", name: "gate_width", options: ["До 3 метрів", "Від 3 до 5 метрів", "Залишити без відповіді"], image: "./img/8.png" },
    { type: "radio", question: "Чи проведено кабель до воріт?", name: "cable_installed", options: ["Так", "Ні"], image: "./img/9.png" },
    { type: "radio", question: "Місцезнаходження об'єкта монтажу?", name: "location", options: ["М. Тернопіль", "Околиці міста Тернопіль (до 10 км)", "Більше 10 км від міста Тернопіль"], image: "./img/4.jpg" },
    { type: "contact", question: "Вкажіть будь ласка ваше ім'я та номер телефону", name: "contact", image: "" }
  ],
  "alarm": [
    { type: "radio", question: "Який тип сигналізації Вас цікавить?", name: "alarm_type", options: ["Проводова", "Безпроводова", "Залишити без відповіді"], image: "./img/13.png" },
    { type: "radio", question: "Який колір Вас цікавить?", name: "alarm_color", options: ["Білий", "Чорний", "Байдуже"], image: "./img/10.png" },
    { type: "radio", question: "Базовий комплект складається з: \r\nІнтелектуальна централь - 1шт; \nБездротовий датчик руху - 1шт; \nБездротовий датчик відкриття - 1шт;\nБездротовий брелок - 1шт;\n\nЧи потрібні додаткові датчики?", name: "extra_sensors", options: ["Так", "Ні", "Залишити без відповіді"], image: "./img/6.png" },
    { type: "radio", question: "Місцезнаходження об'єкта монтажу?", name: "location", options: ["М. Тернопіль", "Околиці міста Тернопіль (до 10 км)", "Більше 10 км від міста Тернопіль"], image: "./img/4.jpg" },
    { type: "contact", question: "Вкажіть будь ласка ваше ім'я та номер телефону", name: "contact", image: "" }
  ],
  "intercom": [
    { type: "radio", question: "Який тип домофону Вам потрібний?", name: "intercom_type", options: ["Приватний", "Багатоквартирний"], image: "./img/12.png" },
    { type: "radio", question: "Чи проведено кабель до місця монтажу домофону?", name: "cable_installed", options: ["Так", "Ні"], image: "./img/11.png" },
    { type: "radio", question: "Місцезнаходження об'єкта монтажу?", name: "location", options: ["М. Тернопіль", "Околиці міста Тернопіль (до 10 км)", "Більше 10 км від міста Тернопіль"], image: "./img/4.jpg" },
    { type: "contact", question: "Вкажіть будь ласка ваше ім'я та номер телефону", name: "contact", image: "" }
  ]
};

const scriptUrls = {
  "video": "https://script.google.com/macros/s/AKfycbwunFEMSJGFr-fI3TME--dyZ5NNrTJJ0ZEIJrDdNVQs-qrPMEOKw999bnaMyK2BFWQp/exec",
  "automation": "https://script.google.com/macros/s/AKfycbxsnX_liEZErsy-8f9f5LtU7QxjWiZ-1k8rLc7Wsy1vOLYcBoJkIOkgzUMTyh850v2V/exec",
  "alarm": "https://script.google.com/macros/s/AKfycbwQAoKesdDqqbf__NFnoj5nKvwWiOiwA7W5ByEi-1H3nNnFx0xx3cPQpQydx4WO1BY3fQ/exec",
  "intercom": "https://script.google.com/macros/s/AKfycbwdwaFX0GuZ9L_WEO8dpDwTjcTe2H0BVmyoLa85fPwLMO4-fUvefCxQ-yDms69BvD5-6Q/exec"
};

let selectedQuestions = [];
let selectedCategoryKey = ""; // Додана змінна для зберігання ключа категорії
let selectedCategoryLabel = "";

let answers = {};
let currentIndex = 0;

const main = document.getElementById("main-content");

function renderCategories() {
  main.innerHTML = "";

  const container = document.createElement("div");
  const title = document.createElement("h2");
  title.textContent = "Що саме вас цікавить?";
  container.appendChild(title);

  const buttons = [
    { key: "video", label: "Відеоспостереження" },
    { key: "automation", label: "Автоматика" },
    { key: "alarm", label: "Сигналізація" },
    { key: "intercom", label: "Домофонія" }
  ];

  buttons.forEach(btn => {
    const button = document.createElement("a");
    button.className = "category-button";
    button.textContent = btn.label;
    button.addEventListener("click", () => {
      selectedQuestions = allQuestions[btn.key];
      selectedCategoryKey = btn.key; // Зберігаємо ключ категорії
      selectedCategoryLabel = btn.label;
      currentIndex = 0;
      answers = {};
      renderQuestion(currentIndex);
    });
    container.appendChild(button);
  });

  main.appendChild(container);
}

function renderQuestion(index) {
  const q = selectedQuestions[index];
  main.innerHTML = "";

  const container = document.createElement("div");
  const error = document.createElement("p");
  error.id = "error-message";
  container.appendChild(error);

  if (q.image) {
    const img = document.createElement("img");
    img.src = q.image;
    img.alt = "Фото до питання";
    container.appendChild(img);
  }

  const label = document.createElement("p");
const indent = "&nbsp;&nbsp;&nbsp;&nbsp;"; // Визначте кількість пробілів для відступу
label.innerHTML = `${index + 1}. ${q.question.replace(/\n/g, '<br>' + indent)}`;
  container.appendChild(label);

  let input;
  if (q.type === "radio") {
    input = document.createElement("div");
    q.options.forEach(option => {
      const optionLabel = document.createElement("label");
      optionLabel.innerHTML = `<input type="radio" name="${q.name}" value="${option}"> ${option}`;
      input.appendChild(optionLabel);
    });
  } else if (q.type === "contact") {
    input = document.createElement("div");
    input.innerHTML = `
      <input type="text" id="name" placeholder="Ваше ім'я"><br>
      <input type="text" id="phone" placeholder="Ваш номер телефону">
    `;
  }

  container.appendChild(input);

  const btn = document.createElement("button");
  btn.textContent = (index === selectedQuestions.length - 1) ? "Надіслати" : "Далі";
  btn.addEventListener("click", () => {
    const errorEl = document.getElementById("error-message");
    errorEl.textContent = "";
    const value = getValue(q);
    if (!value) {
      errorEl.textContent = "Будь ласка, заповніть це поле";
      return;
    }
    Object.assign(answers, value);
    if (index === selectedQuestions.length - 1) {
      sendData();
    } else {
      renderQuestion(index + 1);
    }
  });

  container.appendChild(btn);
  main.appendChild(container);
}

function getValue(q) {
  if (q.type === "radio") {
    const selected = document.querySelector(`input[name="${q.name}"]:checked`);
    return selected ? { [q.name]: selected.value } : null;
  }
  if (q.type === "contact") {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    if (!name || !phone) return null;
    return { name, phone };
  }
  return null;
}

function sendData() {
  const formData = new FormData();
  // Тепер 'category' не потрібна у formData, оскільки кожен скрипт вже "знає" свою категорію
  for (let key in answers) {
    formData.append(key, answers[key]);
  }

  main.innerHTML = "<p>Надсилаємо ваші відповіді...</p>";

  // Отримуємо URL для поточної категорії
  const currentScriptUrl = scriptUrls[selectedCategoryKey]; // Використовуємо ключ категорії для вибору URL

  if (!currentScriptUrl) {
    console.error("Не знайдено URL для обраної категорії:", selectedCategoryKey);
    main.innerHTML = `
      <div>
        <h2>Виникла помилка!</h2>
        <p>Не вдалося відправити дані. Спробуйте ще раз або зв'яжіться з нами.</p>
        <p><a href="/" class="button">Повернутися на головну</a></p>
      </div>
    `;
    return;
  }

  fetch(currentScriptUrl, { // Використовуємо відповідний URL
    method: "POST",
    body: formData
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.text();
  })
  .then(data => {
    console.log("Відповідь сервера:", data);
    showThankYou();
  })
  .catch(err => {
    console.error("Помилка при надсиланні:", err);
    main.innerHTML = `
      <div>
        <h2>Виникла помилка!</h2>
        <p>Не вдалося відправити дані. Спробуйте ще раз або зв'яжіться з нами.</p>
        <p><a href="/" class="button">Повернутися на головну</a></p>
      </div>
    `;
  });
}


function showThankYou() {
  main.innerHTML = `
    <div>
      <h2>Дякуємо за надані відповіді!</h2>
      <p>Наш менеджер скоро з вами зв'яжеться.</p>
      <p><a href="/" class="button">Повернутися на головну</a></p>
      <p><a href="https://cyfrodim.com/" class="button">Відвідати основний сайт</a></p>
    </div>
  `;
}

renderCategories();
</script>

</body>
</html>